ERD for DB:-

https://video.udacity-data.com/topher/2017/November/5a0e2796_screen-shot-2017-11-16-at-3.54.06-pm/screen-shot-2017-11-16-at-3.54.06-pm.png

Subqueries
Table Expressions
Persistent Derived Tables
----------------------------

--For the region with the largest sales total_amt_usd, how many total orders were placed?
select r.name,count(o.total) from sales_reps s 
join region r on s.region_id = r.id 
join accounts a on a.sales_rep_id = s.id 
join orders o on a.id = o.account_id 
group by 1 having sum(o.total_amt_usd) =
(select max(total_Sales) from (select s.name sales_rep,r.name region,sum(o.total_amt_usd) total_Sales from sales_reps s join region r on s.region_id = r.id 
join accounts a on a.sales_rep_id = s.id join orders o on a.id = o.account_id group by 1,2) sub);


--How many accounts had more total purchases than the account name which has bought the most standard_qty paper throughout their lifetime as a customer?

SELECT a.name
FROM orders o
JOIN accounts a
ON a.id = o.account_id
GROUP BY 1
HAVING SUM(o.total) > (SELECT total 
FROM (SELECT a.name act_name, SUM(o.standard_qty) tot_std, SUM(o.total) total
FROM accounts a
JOIN orders o
ON o.account_id = a.id
GROUP BY 1
ORDER BY 2 DESC
LIMIT 1) sub);
